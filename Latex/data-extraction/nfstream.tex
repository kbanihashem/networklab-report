\section{قابلیت‌های کتابخانه‌ی
\lr{nfstream}
}
این کتابخانه برای استخراج داده از فایل‌های
\lr{.pcap}
طراحی شده و با استفاده از آن، می‌توان به طور مستقیم از یک فایل
\lr{.pcap}،
پاکت‌های رد‌وبدل شده در این فایل را به دست آورد و نیز با استفاده از قابلیت‌های کتابخانه، به طور خودکار 
\lr{flow}‌های
موجود در این فایل را شناخت و به طور جداگانه بررسی کرد. برای استفاده از این قابلیت‌ها، کتابخانه‌ی
\lr{nfstream}
از ۳ لایه عملیات استفاده می‌کند که در ادامه به شرح مختصری از هر لایه می‌پردازیم. برای مشاهده‌ی توصیفات کامل‌تر از نحوه‌ی کار لایه‌ها و نیز دیگر قابلیت‌های کتابخانه می‌توانید به 
\href{https://nfstream.github.io/docs/api}{این لینک}
مراجعه کنید.
\subsection{
\lr{NFObserver}
}
در این لایه، کتابخانه با تکیه بر کتاب‌خانه‌ی
\lr{libpcap}،
پاکت‌های رد‌وبدل شده را استخراج می‌کند و با تبدیل آن‌ها به فرم نمونه‌هایی از کلاس
\lr{NFPacket}،
آن‌ها را با لایه‌ی بالایی به اشتراک می‌گذارد. خواصی از پاکت که در این کلاس آورده شده در جدول
\ref{tab:NFpacket}
قابل مشاهده است.
\begin{table}[H]
	\centering
	\caption{فیلد‌های کلاس \lr{NFPacket}}
	\label{tab:NFpacket}
	\begin{tabular}{|c|c|c|}
		\hline
\textbf{		نام فیلد }
		& 
\textbf{		نوع فیلد}
		 & \textbf{توضیح}
		\\\hline
		\lr{time} & \lr{int} & 
		برچسب زمانی پاکت بر حسب میلی‌ثانیه
		\\\hline
		\lr{raw\_size} & \lr{int} & 
سایز پاکت
		\\\hline
		\lr{ip\_size	} & \lr{int} & 
سایز پاکت در لایه‌ی شبکه
		\\\hline
		\lr{transport\_size} & \lr{int} & 
	سایز پاکت در لایه‌ی انتقال
		\\\hline
		\lr{payload\_size} & \lr{int} & 
سایز محتویات پاکت
		\\\hline
		\lr{src\_ip} & \lr{str} & 
آدرس \lr{ip} فرستنده
		\\\hline
		\lr{dst\_ip} & \lr{str} & 
آدرس \lr{ip} گیرنده
		\\\hline
		\lr{src\_port} & \lr{int} & 
شماره‌ی درگاه \lr{ip} فرستنده
		\\\hline
		\lr{dst\_port} & \lr{int} & 
شماره‌ی درگاه \lr{ip} گیرنده
		\\\hline
		\lr{protocol} & \lr{int} & 
پروتوکول مورد استفاده در لایه‌ی انتقال
		\\\hline
		\lr{vlan\_id} & \lr{int} & 
شناسه‌ی \lr{vlan}
		\\\hline
		\lr{version} & \lr{int} & 
نسخه‌ی \lr{IP} مورد استفاده
		\\\hline
		\lr{tcp\_flags} & \lr{namedtuple} & 
پرچم‌های \lr{TCP}‌ای که در پاکت موجودند
		\\\hline
		\lr{ip\_packet} & \lr{bytes} & 
پاکت لایه‌ی شبکه
		\\\hline
		\lr{direction} & \lr{int} & 
جهت پاکت. ۰ به معنای پیام از فرستنده به گیرنده و ۱ به معنای برعکس است.
		\\\hline
	\end{tabular}
\end{table}
\subsection{\lr{NFCache}}
در این لایه، با استفاده از یک 
\lr{cache}
از نوع 
\lr{LRU}،
\lr{flow}‌های
موجود در فایل 
\lr{.pcap}
شناسایی می‌شوند. نحوه‌ی انجام این کار بر اساس این فرض است که پاکت‌های هر 
\lr{flow}
با استفاده از آدرس و درگاه گیرنده و فرستنده، شناسه‌ی \lr{vlan} و نیز نوع پروتوکول استفاده شده در پاکت قابل شناسایی هستند. در نتیجه با بررسی پاکت‌ها با ترتیب زمانی آن‌ها و با محاسبه‌ی یک تابع درهم‌سازی بر اساس معیار‌های گفته شده، می‌توان فهمید که یک پاکت مربوط به یک \lr{flow} قبلا شناسایی شده است و یا این که  اولین پاکت مشاهده شده از یک \lr{flow} جدید است. در حالت اول، این پاکت به لیست پاکت‌های \lr{flow}ی قبلی اضافه می‌شود و در حالت دوم، یک \lr{flow} جدید در جدول درهم‌سازی اضافه می‌شود. همچنین هر \lr{flow} پس از گذشت یک مدت زمان و در صورتی که هیچ پاکتی از آن مشاهده نشود، منقضی شده و از جدول جذف می‌گردد.\\
کلاس‌های اصلی این لایه، 
\lr{NFEntry}
و
\lr{NFPlugin}
هستند. 
کلاس اول در واقع نشان‌دهنده‌ی یک \lr{flow} است و کلاس دوم ابزار مورد نیاز برای استخراج داده از هر \lr{flow} را برای ما فراهم می‌کند. به طو دقیق‌تر، برای استخراج داده، یک زیرکلاس از کلاس 
\lr{NFPlugin}
باید تعریف شود و متود‌های
\lr{on\_init}
و 
\lr{on\_update}
%و
%\lr{on\_expire}
آن را پیاده‌سازی کند. اولین متود صرفا پاکت  (\lr{NFPacket}) ورودی می‌گیرد و با توجه به آن می‌توان اطلاعاتی از \lr{flow} که مورد اهمیت هستند را خروجی داد.
خود کتابخانه با توجه به خروجی، \lr{NFEntry} مناسب را ایجاد می‌کند.\\
 تابع‌
\lr{on\_update}،
یک پاکت و یک \lr{flow} را ورودی می‌گیرد (خود کتابخانه با استفاده از روش درهم‌سازی‌ای که توضیح داده شد، زوج پاکت، \lr{flow} درستی را ورودی می‌دهد) و 
اطلاعات مورد نیاز از \lr{flow} را تغییر می‌دهد.\\
اطلاعاتی از کلاس 
\lr{NFEntry}
که در کاربرد ما اهمیت دارند در جدول
\ref{tab:NFEntry}
قابل مشاهده است. برای مشاهده‌ی دیگر قابلیت‌ها می‌توانید به مستند این کتابخانه مراجع کنید.
\begin{table}[H]
	\centering
	\caption{فیلد‌های کلاس \lr{NFEntry}}
	\label{tab:NFEntry}
	\begin{tabular}{|c|c|c|}
		\hline
		\textbf{		نام فیلد }
		& 
		\textbf{		نوع فیلد}
		& \textbf{توضیح}
		\\\hline
		\lr{application\_name} & \lr{str} & 
نام \lr{application} تشخیص داده شده توسط \lr{nDPI}
		\\\hline
		\lr{category\_name} & \lr{str} & 
نام دسته‌ی \lr{application} تشخیص داده شده توسط \lr{nDPI}
		\\\hline
		\lr{client\_info, server\_info} & \lr{str} & 
اطلاعات مربوط به سرور یا کلاینت مانند 
\lr{http\_detected\_os}
برای
 \lr{http}
%\lr{client\_signature, server\_signature}
%برای 
%\lr{SSH}
%و
%\lr{client\_requested\_server\_name, server\_names}
%برای \lr{SSL
		\\\hline
		\lr{j3a\_info, j3a\_info} & \lr{str} & 
اثرانگشت 
\lr{j3ac}
		\\\hline
	\end{tabular}
\end{table}
\subsection{\lr{NFStreamer}}
در این لایه که عملا لایه‌ی خروجی است، با انتخاب یک فایل \lr{.pcap} و انتخاب تعدادی نمونه از کلاس \lr{NFPlugin}، \lr{flow}‌های این فایل شناسایی شده و با ترتیب گفته شده، پاکت‌های این \lr{flow}‌ها به 
\lr{NGPlugin}‌ها 
داده می‌شوند تا داده‌های مورد نیاز استخراج شوند.
در ادماه، نحوه‌ی استفاده از این کتابخانه در کد ما توضیح داده می‌شود.